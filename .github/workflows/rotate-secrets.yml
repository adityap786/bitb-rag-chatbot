name: Rotate Secrets

on:
  schedule:
    - cron: '0 0 * * 0' # Every Sunday at midnight
  workflow_dispatch:

jobs:
  rotate-secrets:
    runs-on: ubuntu-latest
    steps:
      - name: Generate new secrets
        id: gen
        run: |
          echo "CDN_API_TOKEN=$(openssl rand -hex 32)" >> $GITHUB_ENV
          echo "METRICS_API_KEY=$(openssl rand -hex 32)" >> $GITHUB_ENV
      - name: Update GitHub secrets
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          REPO: ${{ github.repository }}
        run: |
          gh secret set CDN_API_TOKEN -b"$CDN_API_TOKEN" -R "$REPO"
          gh secret set METRICS_API_KEY -b"$METRICS_API_KEY" -R "$REPO"
